/* styles/chat.css — full replacement */

/* ===== Root + resets ===== */
:root{
  --bb-pink: linear-gradient(180deg,#ff2d83,#ff165f);
  --bg-dark: #0b0b0e;
  --ink: #f5f6f8;
  --ink-dim: #c9cbd1;
  --bubble-self: rgba(255,45,131,0.12);
  --bubble-them: rgba(255,255,255,0.08);
  --border: rgba(255,255,255,0.08);
  --shadow: 0 6px 24px rgba(0,0,0,0.35);
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;padding:0;background:var(--bg-dark);color:var(--ink);font:500 16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;-webkit-text-size-adjust:100%}

/* ===== Page background (full-bleed wallpaper behind everything) ===== */
body.has-wallpaper{
  /* chat.html should set body.has-wallpaper with inline style for per-man bg, e.g. style="background-image:url('/images/characters/blade/blade-bg.jpg')" */
  background-repeat:no-repeat;
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
}

/* ===== Layout regions =====
Expected structure in chat.html:
<body class="has-wallpaper">
  <div id="hero"> ... fixed portrait ... </div>
  <main id="feed"> ... messages ... </main>
  <form id="composerForm" class="composer"> ... input + button ... </form>
</body>
*/

/* HERO (desktop: left column feel; mobile: fixed ~38vh) */
#hero{
  position:sticky; /* behaves like a left rail on wide screens */
  top:0;
  height:100vh;
  max-height:100vh;
  display:flex;
  align-items:flex-end;
  padding:24px;
  background:linear-gradient(180deg,rgba(0,0,0,0.0),rgba(0,0,0,0.45));
  backdrop-filter:saturate(120%) blur(0.5px);
}
#hero .portrait{
  width:100%;
  max-width:520px;
  border-radius:16px;
  box-shadow:var(--shadow);
  display:block;
}

/* FEED (scroll container on mobile; normal flow desktop) */
#feed{
  width:100%;
  max-width:900px;
  margin:0 auto;
  padding:24px 20px 120px; /* bottom space for composer on desktop too */
}

/* Composer (pinned on mobile; anchored bottom) */
.composer{
  display:flex;
  gap:10px;
  align-items:center;
  padding:12px;
  background:rgba(15,15,20,0.8);
  border-top:1px solid var(--border);
  backdrop-filter:saturate(120%) blur(6px);
}
.composer input[type="text"],
.composer textarea{
  flex:1;
  min-height:44px;
  padding:12px 14px;
  font-size:16px; /* >=16px to avoid iOS zoom */
  line-height:1.3;
  color:var(--ink);
  background:rgba(255,255,255,0.06);
  border:1px solid var(--border);
  border-radius:12px;
  outline:none;
}
.composer button,
.button-pink{
  min-height:44px;
  padding:0 16px;
  font-weight:700;
  color:white;
  background:var(--bb-pink);
  border:none;
  border-radius:12px;
  box-shadow:0 6px 14px rgba(255,22,95,0.25);
  cursor:pointer;
}

/* Message bubbles */
.msg{
  max-width:78ch;
  padding:12px 14px;
  border-radius:14px;
  margin:10px 0;
  border:1px solid var(--border);
  box-shadow:0 2px 10px rgba(0,0,0,0.18);
  word-wrap:break-word;
  backdrop-filter:saturate(120%);
}
.msg.them{background:var(--bubble-them); margin-right:auto}
.msg.you{background:var(--bubble-self); margin-left:auto}

/* Timestamp / meta */
.meta{display:block;margin-top:6px;color:var(--ink-dim);font-size:12px}

/* Strip elements that shouldn't show on phones */
.mini, .roster, .footer-strip{ /* visible on desktop by default */
  opacity:0.9;
}

/* ===== Desktop grid (≥900px) ===== */
@media (min-width:901px){
  body{
    display:grid;
    grid-template-columns:minmax(340px,520px) 1fr;
    grid-template-rows:auto 1fr auto;
    grid-template-areas:
      "hero feed"
      "hero feed"
      "hero composer";
    height:100%;
    overflow:auto; /* desktop can scroll body */
  }
  #hero{grid-area:hero}
  #feed{grid-area:feed}
  .composer{grid-area:composer; position:sticky; bottom:0}
}

/* ===== Single consolidated MOBILE block (≤900px) — non-negotiable behavior ===== */
@media (max-width:900px){
  /* Body itself must NOT scroll; only #feed scrolls */
  html, body{height:100%}
  body{
    overflow:hidden; /* lock the page */
    position:relative;
  }

  /* Fixed hero ~38vh at top */
  #hero{
    position:fixed;
    left:0; right:0; top:0;
    height:38vh;
    max-height:38vh;
    padding:12px;
    display:flex;
    align-items:flex-end;
    justify-content:center;
    background:linear-gradient(180deg,rgba(0,0,0,0.0),rgba(0,0,0,0.55));
    pointer-events:none; /* taps go to feed unless interactive children need it */
  }
  #hero .portrait{
    width:55%;
    max-width:62vh; /* scales with viewport height nicely */
    border-radius:14px;
  }

  /* Feed is the ONLY scrollable region */
  #feed{
    position:fixed;
    left:0; right:0;
    /* Start right below the hero */
    top:38vh; 
    /* End above the composer; account for safe-area */
    bottom:calc(64px + env(safe-area-inset-bottom,0px));
    overflow:auto;
    -webkit-overflow-scrolling:touch;
    padding:14px 14px 24px;
    margin:0;
    backdrop-filter:saturate(120%) blur(0px);
  }

  /* Pinned composer at bottom, never disappears */
  .composer{
    position:fixed;
    left:0; right:0;
    bottom:0;
    padding:10px calc(10px + env(safe-area-inset-right,0px)) calc(10px + env(safe-area-inset-bottom,0px)) calc(10px + env(safe-area-inset-left,0px));
    border-top:1px solid var(--border);
    background:rgba(12,12,18,0.86);
  }
  .composer input[type="text"],
  .composer textarea{
    font-size:16px; /* keep ≥16px to defeat iOS zoom */
    border-radius:12px;
  }
  .composer button{min-width:84px}

  /* Hide any mini/roster/footer strips on phones */
  .mini, .roster, .footer-strip{display:none !important}

  /* Bubble sizing feels better on small screens */
  .msg{max-width:90%; padding:10px 12px; border-radius:12px}
}

/* ===== Utilities ===== */
.hidden{display:none !important}
.spacer{height:20px}
a.btn{display:inline-flex;align-items:center;justify-content:center;text-decoration:none}
a.btn.pink{background:var(--bb-pink);color:#fff;border-radius:12px;padding:10px 14px;font-weight:700}
