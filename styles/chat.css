/* ==== Theme tokens ======================================================= */
:root{
  --bg: #0a0b12;
  --glass: rgba(18,20,34,.28);
  --glass-border: #262842;

  --ink: #e9e9f5;
  --ink-dim: #b7b9d6;
  --ink-faint: #8a8db0;

  --you: linear-gradient(180deg, #ff2d6f, #ff165f);
  --you-ink: #fff;

  --radius-lg: 16px;
  --radius-md: 12px;

  --send: #ff2d86;
  --send-glow: rgba(255,46,139,.35);
  --input-bg: rgba(14,16,22,.10);
  --placeholder: rgba(255,255,255,.55);
  --bubble-text: var(--ink);

  /* elevation helpers */
  --elev-1: 0 6px 20px rgba(0,0,0,.35);
  --elev-2: 0 10px 30px rgba(0,0,0,.50);
  --edge-hi: inset 0 1px 0 rgba(255,255,255,.06);
  --edge-lo: inset 0 -1px 0 rgba(0,0,0,.35);
}

*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0;
  background: var(--bg);
  color: var(--ink);
  font: 16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Helvetica Neue",Arial,sans-serif;
}

/* ==== Header ============================================================= */
.topbar{
  position: sticky; top:0; z-index: 5;
  display:flex; justify-content:space-between; align-items:center;
  padding:14px 22px;
  background: linear-gradient(to bottom, rgba(10,11,18,.9), rgba(10,11,18,.6));
  border-bottom:1px solid var(--glass-border);
  backdrop-filter:saturate(120%) blur(8px);
}
.topbar .brand, .topbar .right a{
  color:var(--ink-dim); text-decoration:none; font-weight:600;
}

/* ==== Layout ============================================================= */
.stage{
  display:grid; grid-template-columns: 360px 1fr; gap:24px;
  max-width:1200px; margin:24px auto; padding:0 24px 24px;
}

.portraitPanel img{
  width:100%; height:auto; aspect-ratio:3/4; object-fit:cover;
  border-radius:var(--radius-lg);
  border:1px solid var(--glass-border);
  filter: drop-shadow(0 18px 36px rgba(0,0,0,.60));
}

/* Chat panel card */
.chatPanel{
  position:relative;
  display:flex; flex-direction:column;
  min-height:60vh;
  border-radius:var(--radius-lg);
  border:1px solid rgba(255,255,255,.05);
  background: var(--glass);
  backdrop-filter:none !important;             /* never blur the wallpaper */
  -webkit-backdrop-filter:none !important;
  box-shadow: var(--elev-2), var(--edge-lo);
  padding:18px;
}

/* Wallpaper sits behind everything inside the panel */
#chatWallpaper{
  position:absolute; inset:0;
  z-index:0;                                    /* bottom */
  background: center / cover no-repeat;
  /* JS sets background-image to a character JPG; keep a safe default: */
  background-image: url('/images/bg/default.webp');
  opacity:.22;
  pointer-events:none;
}

/* Subtle glass sweep for depth (non-blocking) */
.chatPanel .chatGlass{
  position:absolute; inset:0;
  z-index:1;                                    /* above wallpaper */
  pointer-events:none;
  background:
    radial-gradient(1100px 420px at 50% 0%, rgba(255,255,255,.06), rgba(0,0,0,0)),
    linear-gradient(180deg, rgba(12,12,16,.07), rgba(12,12,16,.03));
  box-shadow: inset 0 20px 60px rgba(0,0,0,.12);
  opacity:.9;
}

/* Feed (messages) lives above the tint */
#feed{
  position:relative; z-index:2;
  min-height:240px;
  max-height:calc(100vh - 280px);
  overflow-y:auto;
  padding:12px 16px;
  font-size:16px; line-height:1.45;
}

/* Bubbles */
.msg{
  max-width:720px;
  margin:10px 0;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.06);
  background: rgba(255,255,255,.04);
  color:var(--bubble-text);
  box-shadow: 0 6px 14px rgba(0,0,0,.20), var(--edge-hi);
  transform: translateZ(0);
}
.msg .meta{
  display:block; font-size:12px; opacity:.65; margin-bottom:4px;
}
.msg.man{
  align-self:flex-start; background: rgba(255,255,255,.05);
}
.msg.you{
  align-self:flex-end;
  background: var(--you); color: var(--you-ink);
  border-color: rgba(255,46,139,.25);
  box-shadow: 0 6px 18px rgba(0,0,0,.5), var(--edge-hi);
}
.msg.you .meta{ color:var(--you-ink); opacity:.95; }

/* typing indicator */
.msg.typing .text, .msg.typing .dots{ display:inline-block; }
.dots{ width:26px; height:10px; position:relative; }
.dots::before, .dots::after, .dots span{
  content:""; position:absolute; top:0; width:6px; height:6px; border-radius:50%;
  background: currentColor; opacity:.65; animation: bump 1.2s infinite ease-in-out;
}
.dots span{ left:10px; animation-delay:.12s }
.dots::before{ left:0 }
.dots::after{ left:20px; animation-delay:.24s }
@keyframes bump { 0%,60%,100%{transform:translateY(0)} 30%{transform:translateY(-4px)} }

/* Composer row (sticks to bottom of panel flow) */
.composer{
  position:relative; z-index:2;
  display:flex; gap:12px; align-items:center;
  margin-top:auto; padding-top:10px;
  background: linear-gradient(to top, rgba(10,11,18,.85) 0%, rgba(10,11,18,0) 100%);
  box-shadow: var(--elev-1), var(--edge-lo);
  border:1px solid rgba(255,255,255,.06);
  border-radius:12px;
  padding:12px;
}

#composer{
  flex:1; height:48px; padding:0 16px;
  background: var(--input-bg);
  color:#fff;
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  outline:none;
  box-shadow: inset 0 6px 22px rgba(0,0,0,.22);
  appearance:none; -webkit-appearance:none;
}
#composer::placeholder{ color:var(--placeholder) }
#composer:focus{
  outline:2px solid var(--send);
  box-shadow: inset 0 6px 22px rgba(0,0,0,.22);
}

#sendBtn{
  height:48px; padding:0 16px;
  background: var(--send);
  color:#fff; border:0; border-radius:14px; cursor:pointer;
  box-shadow:0 0 10px var(--send-glow);
}
#sendBtn:hover{ filter:brightness(1.06); transform: translateY(-1px) }
#sendBtn:active{ transform:none }

/* Per-man lightening example (tune per character as needed) */
body[data-man="viper"]{
  --input-bg: rgba(14,16,22,.12);
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .msg, .chatPanel, .composer, .portraitPanel img, #sendBtn{ transition:none !important; }
}
