/* ===== Blossom & Blade — Chat (consolidated) ========================= */
/* Theme tokens */
:root{
  --bg: #0b0e16;
  --ink: #e9eaf5;
  --ink-dim: #b7b9d6;
  --ink-faint: #8b8fb1;
  --panel: rgba(15,17,28,.42);
  --panel-border: rgba(255,255,255,.08);
  --you: #ff2e8b;
  --you-ink: #fff;

  /* chat layout constants */
  --header-h: 64px;    /* top bar height (if any) */
  --portrait-h: 520px; /* desktop portrait height */
  --composer-h: 90px;  /* sticky input row incl. padding */
}
*{ box-sizing: border-box }
html,body{ height:100% }
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font:16px/1.5 system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial,sans-serif;
}
body, button, a { touch-action: manipulation; }

/* Prevent iOS zoom on focus */
input[type="text"], textarea{ font-size:16px }

/* ===== Shell ========================================================= */
.wrap{
  max-width:1100px; margin:22px auto; padding:0 16px;
  display:grid; grid-template-columns: 420px 1fr; gap: 28px;
}

/* ===== Portrait (fixed panel) ======================================= */
.portraitPanel{ position:relative; z-index:3 }
.portraitPanel img{
  width:100%; height:540px; aspect-ratio:3/4; object-fit:cover;
  border-radius:14px; border:1px solid rgba(255,255,255,.06);
  filter: brightness(1.18) contrast(1.18) saturate(1.06)
          drop-shadow(0 26px 64px rgba(0,0,0,.58));
}

/* ===== Chat panel (right side) ====================================== */
.chatPanel{
  position:relative;
  min-height:60vh;
  border:1px solid var(--panel-border);
  border-radius:16px;
  background:rgba(12,14,22,.28);
  padding:18px 18px calc(18px + var(--composer-h)); /* room for composer */
  box-shadow:0 30px 50px rgba(0,0,0,.45);
}

/* Full-viewport wallpaper stays behind everything */
#chatWallpaper{
  position:fixed; inset:0; z-index:0;                 /* << full page */
  background:center / cover no-repeat;
  opacity:.78;
  filter: brightness(1.10) contrast(1.06) saturate(1.02);
  pointer-events:none;
}

/* Glass tint over the chat panel */
.chatGlass{
  position:absolute; inset:0; z-index:1; pointer-events:none;
  background:
    radial-gradient(1100px 420px at 55% 0%, rgba(255,255,255,.08), transparent),
    linear-gradient(180deg,
      rgba(10,12,18,.55) 0%,
      rgba(10,12,18,.18) 28%,
      rgba(10,12,18,.18) 78%,
      rgba(10,12,18,.55) 100%);
}

/* ===== Feed (scrolls), bubbles ====================================== */
#feed{
  position:relative; z-index:2;
  max-width:880px; margin:6px auto 0;
  padding:10px 10px calc(10px + var(--composer-h));
  min-height:260px;
  max-height: calc(100vh - 300px);
  overflow-y:auto;
}
#feed .msg{
  display:inline-block;
  width:fit-content;
  max-width:72ch;             /* readable wrap */
  margin:10px 0;
  padding:12px 14px;
  border-radius:18px;
  background: rgba(15,17,25,.72);
  border:1px solid rgba(255,255,255,.06);
  box-shadow:0 6px 20px rgba(0,0,0,.40);
}
#feed .msg .meta{
  display:block; font-size:12px; opacity:.80; margin-bottom:6px;
  color: rgba(233,233,245,.85);
}
/* you bubble (softer pink) */
#feed .msg.you{
  background: rgba(255,46,139,.08);
  border-color: rgba(255,46,139,.20);
  color: var(--you-ink);
}
#feed .msg.you .meta{ color:#fff }

/* ===== Sticky Composer (bottom, fixed) ============================== */
.composer{
  position:fixed; left:0; right:0;
  bottom:0; z-index:9999;
  display:flex; gap:12px; align-items:center;
  padding:14px 16px calc(14px + env(safe-area-inset-bottom));
  background: rgba(10,10,14,.55);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-top:1px solid rgba(255,255,255,.08);
  height: var(--composer-h);
}
#input{
  flex:1 1 auto; min-width:0;
  height:52px; border-radius:14px; padding:0 16px;
  border:1px solid rgba(255,255,255,.12);
  color:#eaeaf5;
  background: rgba(13,16,24,.85);
}
#input::placeholder{ color: rgba(234,234,245,.55) }
#sendBtn{
  height:52px; border-radius:14px; padding:0 18px;
  border:none; font-weight:700;
  color:#fff;
  background: linear-gradient(180deg,#ff2d6f,#ff165f);
  box-shadow:0 8px 20px rgba(255,45,111,.35);
}

/* ===== Small elevations ============================================ */
.portraitPanel img, .chatPanel, #sendBtn, #feed .msg{
  transition:transform .18s ease, box-shadow .18s ease;
}
@media (hover:hover){
  .portraitPanel img:hover{ transform:translateY(-2px) }
  #feed .msg:hover{ transform:translateY(-1px) }
}

/* ===== Phones: stack portrait above chat, keep composer readable ==== */
@media (max-width: 900px){
  .wrap{ grid-template-columns:1fr; gap:16px; }

  .portraitPanel{ order:0 }
  .chatPanel{ order:1; padding-bottom: calc(18px + var(--composer-h)) }

  /* show portrait on mobile */
  .portraitPanel{ display:block !important; padding: 0 2px 0 }

  /* feed leaves room for the sticky composer */
  #feed{ padding-bottom: calc(128px + env(safe-area-inset-bottom)) }

  /* make sure bubbles & input are easily readable */
  #feed .msg{ font-size:16px; line-height:1.35; }
 /* Hide footer/mini-card rows on phones */
.miniProfile, .roster, .picker, .cardRow, .manRow {
  display: none !important;
}
 
}

/* Containment guard (prevents odd artifacts on some phones) */
#app, main.wrap, .chatPanel { contain: layout paint; }
/* ==== BnB mobile lock-in (portrait fixed, full-room wallpaper, tidy bottom) ==== */

/* Wallpaper must cover the whole viewport behind everything */
#chatWallpaper{
  position: fixed;
  inset: 0;
  background: center / cover no-repeat;
  opacity: .70;
  z-index: 0;               /* stays behind portrait, feed, composer */
  pointer-events: none;
}

/* Keep the page from creating extra page scroll; only the feed should scroll */
html, body { height: 100%; overflow: hidden; }

/* Desktop stays as-is; mobile gets the locked layout */
@media (max-width: 900px){

  /* Fix the hero image at the very top (under the header) */
  #portrait{
    position: fixed;
    top: 64px;                          /* header height; tweak if your header differs */
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 32px);           /* 16px side padding */
    height: 38vh;                       /* how tall you want the hero; change to taste */
    object-fit: cover;
    object-position: center;
    border-radius: 18px;
    box-shadow: 0 8px 24px rgba(0,0,0,.35);
    z-index: 2;
    display: block;
  }

  /* The messages area lives UNDER the hero and scrolls */
  #feed{
    position: relative;
    z-index: 2;
    margin-top: calc(38vh + 16px);      /* clears the fixed hero + a little gap */
    padding: 12px 16px calc(140px + env(safe-area-inset-bottom));
    height: auto;
    max-height: none;
    overflow-y: auto;                    /* only this scrolls on mobile */
    -webkit-overflow-scrolling: touch;
  }

  /* Input bar fixed to bottom */
  .composer{
    position: fixed;
    left: 0; right: 0; bottom: 0;
    z-index: 3;
    display: flex; gap: 10px; align-items: center;
    padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
    background: rgba(10,10,14,.55);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-top: 1px solid rgba(255,255,255,.08);
  }

  /* Big, readable input prevents iOS zoom */
  #input{
    flex: 1 1 auto; min-width: 0;
    height: 52px; font-size: 16px;
    border-radius: 14px; padding: 0 16px;
    border: 1px solid rgba(255,255,255,.12);
    color: #eaeaf5; background: rgba(13,16,24,.85);
  }
  #sendBtn{ height: 52px; border-radius: 14px; padding: 0 18px; }
}

/* Hide any stray “mini profile card / strip” that might render below the composer */
.chatPanel + .card,
.chatPanel + .mini,
.chatPanel + .profile,
.chatPanel + .men,
.composer ~ .card,
.composer ~ .mini,
.composer ~ .profile,
.composer ~ .men{
  display: none !important;
}
/* === BnB mobile composer hard-lock (always visible) === */
@media (max-width: 900px){

 /* Let the browser adjust for the keyboard; avoid clipping fixed composer */
html, body { min-height: 100%; overflow-x: hidden; }


  /* Keep the bubbles area below the hero and above the composer */
  #feed{
    position: relative;
    z-index: 2;
    margin-top: calc(46vh + 16px);        /* clears the fixed hero */
    padding: 12px 16px calc(168px + env(safe-area-inset-bottom));
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Force the composer to be visible and clickable at the bottom */
  .composer{
    position: fixed !important;
    left: 0; right: 0; bottom: 0;
    display: flex !important;
    gap: 10px; align-items: center;
    padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
    background: rgba(10,10,14,.55);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-top: 1px solid rgba(255,255,255,.08);
    z-index: 9999;
    pointer-events: auto;
  }

  /* Big readable input prevents iOS zoom & keeps layout clean */
  #input{
    flex: 1 1 auto; min-width: 0;
    height: 52px; font-size: 16px;
    border-radius: 14px; padding: 0 16px;
    border: 1px solid rgba(255,255,255,.12);
    color: #eaeaf5; background: rgba(13,16,24,.85);
  }
  #input::placeholder{ color: rgba(234,234,245,.55); }

  #sendBtn{
    height: 52px; border-radius: 14px;
    padding: 0 18px; font-weight: 700;
    border: 0; color: #fff;
    background: linear-gradient(180deg,#ff2d6f,#ff165f);
    box-shadow: 0 8px 20px rgba(255,45,111,.35);
    flex: 0 0 auto;
  }
}

/* Just in case any container tries to clip the fixed bar */
.chatPanel, main.wrap { overflow: visible; }
/* ===== FINAL MOBILE FIXUPS (force composer visible, stop zoom, lock layout) ===== */
@media (max-width: 900px){

  /* Keep the hero fixed but shorter so the feed and composer both fit */
  #portrait{
    height: 38vh !important;
  }

  /* Messages live under the hero and above the composer; only this scrolls */
  #feed{
    margin-top: calc(38vh + 16px) !important;
    /* leave room so the fixed composer never covers the last bubbles */
    padding-bottom: calc(132px + env(safe-area-inset-bottom)) !important;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    z-index: 2;
  }

  /* Pinned input bar at the bottom, always clickable and above all layers */
  .composer{
    position: fixed !important;
    left: 0; right: 0; bottom: 0;
    display: flex; gap: 10px; align-items: center;
    padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
    background: rgba(10,10,14,.55);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-top: 1px solid rgba(255,255,255,.08);
    z-index: 9999;
    pointer-events: auto;
  }

  /* Prevent iOS/Android zoom-on-focus and make the input comfy to tap */
  #input{
    flex: 1 1 auto; min-width: 0;
    height: 52px; min-height: 52px;
    font-size: 16px !important;        /* critical: kills auto-zoom */
    border-radius: 14px;
    padding: 0 16px;
  }

  #sendBtn{
    height: 52px;
    border-radius: 14px;
  }
}

/* Reduce double-tap delays and accidental zooms on controls */
body, button, a, input { touch-action: manipulation; }

/* ===== Persist mobile composer + no-zoom safety net ===== */
@media (max-width: 900px){
  .composer{
    position: fixed !important;
    left: 0; right: 0; bottom: 0;
    display: flex !important;          /* never hidden */
    gap: 10px; align-items: center;
    padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
    background: rgba(10,10,14,.55);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-top: 1px solid rgba(255,255,255,.08);
    z-index: 9999;
    pointer-events: auto;
  }
  #input{
    display: block !important;
    flex: 1 1 auto; min-width: 0;
    height: 52px; min-height: 52px;
    font-size: 16px !important; /* prevents mobile zoom */
    border-radius: 14px; padding: 0 16px;
  }
  #sendBtn{
    display: block !important;
    height: 52px; border-radius: 14px;
  }
  /* leave room so composer never covers the last bubble */
  #feed{
    padding-bottom: calc(132px + env(safe-area-inset-bottom)) !important;
    -webkit-overflow-scrolling: touch;
  }
}
body, button, a, input { touch-action: manipulation; }
