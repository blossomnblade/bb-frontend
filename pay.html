<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Choose Your Plan — Blossom & Blade</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/styles/home.css" />
  <style>
    .plans{max-width:820px;margin:32px auto;display:grid;gap:16px}
    .plan-card{border:1px solid #333;border-radius:16px;padding:20px;background:#0f0f11}
    .plan-card h2{margin:0 0 6px}
    .sub{opacity:.8}
    .primary{outline:2px solid #555}
  </style>
</head>
<body>
  <body>
  <div id="bg" aria-hidden="true"></div>

  <main class="wrap">
    …
  </main>
</body>

  <main class="wrap">
    <h1>Pick your access</h1>
    <div class="plans">
      <div class="plan-card">
        <h2>Day Pass — $7.99</h2>
        <div class="sub">One man (your choice), 24 hours.</div>
        <div class="cta"><button data-plan="daypass" class="button ghost">Continue</button></div>
      </div>
      <div class="plan-card primary">
        <h2>Monthly — $14.99</h2>
        <div class="sub">All six unlocked • $1 to Domestic Violence charity • Memory continuity</div>
        <div class="cta"><button data-plan="monthly" class="button">Continue</button></div>
      </div>
    </div>
    <p class="hint">$1 of every Monthly supports a Domestic Violence charity.</p>
  </main>

  <script>
    const API_BASE="https://api.blossomnblade.com";
    document.querySelectorAll("button[data-plan]").forEach(btn=>{
      btn.onclick = async ()=>{
        const plan = btn.getAttribute("data-plan");
        try{
          const res = await fetch(API_BASE + "/api/checkout",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({plan})
          });
          const data = await res.json();
          if (data && data.redirect) { location.href = data.redirect; return; }
          alert("Checkout link not ready yet. We’ll hook this up soon.");
        }catch(e){
          alert("Checkout server not live yet. That’s normal right now.");
        }
      };
    });
  </script>
  <!-- === BEGIN: BB checkout (paste just above </body>) =================== -->
<section id="bb-checkout" style="max-width:840px;margin:32px auto;padding:20px;border-radius:14px;background:#121317;border:1px solid #23262d">
  <h2 style="margin:0 0 12px">Choose your access</h2>
  <p style="opacity:.8;margin:0 0 16px">No auto-billing unless you check “Renew monthly”.</p>

  <label style="display:flex;align-items:center;gap:.6rem;margin:.5rem 0 1rem">
    <input id="bb-renew" type="checkbox">
    <span>Renew monthly (auto-billing)</span>
  </label>

  <div style="display:flex;gap:12px;flex-wrap:wrap">
    <button id="bb-buy-monthly" style="padding:.8rem 1.2rem;border-radius:10px;background:#ff2d7a;border:0;color:white;font-weight:700">
      Get monthly
    </button>
    <button id="bb-buy-day" style="padding:.8rem 1.2rem;border-radius:10px;background:#2b2f36;border:1px solid #3b4049;color:white">
      Day Pass — $7.99
    </button>
  </div>

  <p style="opacity:.7;margin-top:12px;font-size:.9rem">
    You’ll get instant access after payment. Adults-only, fantasy chat.
  </p>
</section>

<script>
/* Replace these three URLs with your processor product links.
   You can use:
   - CCBill FlexForms product links (or dynamic pricing URLs you sign on your server)
   - Segpay subscription/product links
   - Epoch buy links
   Keep the ?custom1= part—we append the selected man so the postback can grant the right access for a Day Pass.
*/
const LINKS = {
  monthly_one_time : 'https://PROCESSOR.example/buy?product=MONTHLY_ONETIME',   // no rebill
  monthly_recurring: 'https://PROCESSOR.example/buy?product=MONTHLY_RECUR',     // auto-renew
  day_pass         : 'https://PROCESSOR.example/buy?product=DAY_PASS'           // 24 hours
};

// Helper: get current man from URL, default blade
function currentMan() {
  const q = new URLSearchParams(location.search);
  return (q.get('man') || 'blade').toLowerCase();
}
// Append ?custom1=<man> (or change to custom field your processor uses)
function withMan(url) {
  const sep = url.includes('?') ? '&' : '?';
  return url + sep + 'custom1=' + encodeURIComponent(currentMan());
}

document.getElementById('bb-buy-monthly').addEventListener('click', () => {
  const renew = document.getElementById('bb-renew').checked;
  const url = renew ? LINKS.monthly_recurring : LINKS.monthly_one_time;
  location.href = withMan(url);
});
document.getElementById('bb-buy-day').addEventListener('click', () => {
  location.href = withMan(LINKS.day_pass);
});
</script>
<!-- === END: BB checkout ================================================ -->

</body>
</html>
